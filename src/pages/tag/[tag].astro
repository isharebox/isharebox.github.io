---
import Layout from "@/layouts/Layout.astro";
import { getPageList } from "@/pages/api/post/list";

const tag = (Astro.params as any).tag;

const all = await getPageList();
const posts = all.filter((v) => v.tags.includes(decodeURIComponent(tag)));

function formatDate(dateStr: string) {
  return new Date(dateStr).toISOString().split('T')[0];
}

export const getStaticPaths = async () => {
  const all = await getPageList();
  return all
    .map((p) => p.tags)
    .flat()
    .filter((t) => t && t.length > 0)
    .map((p) => ({
      params: { tag: p },
    }));
};
---

<Layout title={`#${decodeURIComponent(tag)}`}>
  <main>
    <div class="content">
      <!-- 标签标题 -->
      <div class="tag-header">
        <h1 class="tag-title">
          <span class="tag-hash">#</span>{decodeURIComponent(tag)}
        </h1>
        <span class="tag-count">{posts.length} posts</span>
      </div>

      <!-- 紧凑文章列表 -->
      <ul class="post-list">
        {posts.map((item) => (
          <li class="post-item">
            <time class="post-date">{formatDate(item.createTime)}</time>
            <a href={`/post/${item.id}`} class="post-title">{item.title}</a>
          </li>
        ))}
      </ul>

      <a href="/tag" class="back-link">← All Tags</a>
    </div>
  </main>
</Layout>

<style>
  main {
    display: flex;
    justify-content: center;
    width: 100%;
    padding: 0 16px;
  }

  .content {
    width: 100%;
    max-width: 720px;
    padding: 2rem 0;
  }

  .tag-header {
    text-align: center;
    padding: 2rem 0 1.5rem;
    border-bottom: 1px dashed #292e42;
    margin-bottom: 1rem;
  }

  .tag-title {
    font-size: 1.8rem;
    font-weight: 600;
    color: #c8d3f5;
    margin-bottom: 0.5rem;
  }

  .tag-hash {
    color: #7aa2f7;
    margin-right: 0.2rem;
  }

  .tag-count {
    color: #565f89;
    font-size: 0.9rem;
  }

  .post-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .post-item {
    display: flex;
    align-items: baseline;
    gap: 1.5rem;
    padding: 0.35rem 0;
    transition: background 0.15s;
  }

  .post-item:hover {
    background: rgba(74, 158, 255, 0.05);
  }

  .post-date {
    font-family: "SF Mono", Monaco, monospace;
    font-size: 0.8rem;
    color: #565f89;
    min-width: 90px;
    flex-shrink: 0;
  }

  .post-title {
    color: #7aa2f7;
    font-size: 0.95rem;
    text-decoration: none;
    transition: color 0.2s;
  }

  .post-title:hover {
    color: #c8d3f5;
    text-decoration: underline;
  }

  .back-link {
    display: block;
    margin-top: 2rem;
    color: #565f89;
    font-size: 0.9rem;
    text-decoration: none;
  }

  .back-link:hover {
    color: #7aa2f7;
  }
</style>
