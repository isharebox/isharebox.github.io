{"__ud_title":"how to keep openclaw and frpc on","__ud_tags":[],"__ud_update_time":1770466052693,"__ud_create_time":1770466050849,"__ud_draft":false,"type":"doc","content":[{"type":"heading","attrs":{"level":1,"id":null},"content":[{"type":"text","text":"how to keep openclaw and frpc on"}]},{"type":"heading","attrs":{"level":3,"id":"问题场景"},"content":[{"type":"text","text":"问题场景"}]},{"type":"paragraph","content":[{"type":"text","text":"在 Android 设备上运行 frpc（内网穿透客户端）和 OpenClaw 时，面临以下挑战："}]},{"type":"orderedList","attrs":{"start":1,"type":null},"content":[{"type":"listItem","content":[{"type":"paragraph","content":[{"type":"text","marks":[{"type":"bold"}],"text":"手机重启后服务不自动启动"},{"type":"hardBreak"},{"type":"text","text":"Android 系统不会自动运行 Termux 中的后台服务"}]}]},{"type":"listItem","content":[{"type":"paragraph","content":[{"type":"text","marks":[{"type":"bold"}],"text":"进程崩溃后不会重启"},{"type":"hardBreak"},{"type":"text","text":"frpc 或 OpenClaw 可能因网络波动、内存不足等原因崩溃，需要手动介入"}]}]},{"type":"listItem","content":[{"type":"paragraph","content":[{"type":"text","marks":[{"type":"bold"}],"text":"无法方便地查看日志"},{"type":"hardBreak"},{"type":"text","text":"后台运行的进程没有会话管理，调试困难"}]}]}]},{"type":"heading","attrs":{"level":3,"id":"需求"},"content":[{"type":"text","text":"需求"}]},{"type":"bulletList","content":[{"type":"listItem","content":[{"type":"paragraph","content":[{"type":"text","text":"✅ 手机开机后 frpc + OpenClaw 自动启动"}]}]},{"type":"listItem","content":[{"type":"paragraph","content":[{"type":"text","text":"✅ 进程崩溃后自动检测并重启"}]}]},{"type":"listItem","content":[{"type":"paragraph","content":[{"type":"text","text":"✅ 方便查看运行日志"}]}]},{"type":"listItem","content":[{"type":"paragraph","content":[{"type":"text","text":"✅ 低资源占用（不频繁检测）"}]}]}]},{"type":"horizontalRule"},{"type":"heading","attrs":{"level":2,"id":"方案概述"},"content":[{"type":"text","text":"方案概述"}]},{"type":"paragraph","content":[{"type":"text","text":"利用 Termux 生态中的三个工具组合："}]},{"type":"paragraph","content":[{"type":"text","text":"工具 作用 "},{"type":"text","marks":[{"type":"bold"}],"text":"termux:boot"},{"type":"text","text":" 开机时自动执行脚本 "},{"type":"text","marks":[{"type":"bold"}],"text":"termux-wake-lock"},{"type":"text","text":" 防止系统休眠杀死进程 "},{"type":"text","marks":[{"type":"bold"}],"text":"tmux"},{"type":"text","text":" 会话管理（保持进程运行、方便查看日志） "},{"type":"text","marks":[{"type":"bold"}],"text":"cron"},{"type":"text","text":" 定时任务（每5分钟检测进程存活）"}]},{"type":"heading","attrs":{"level":3,"id":"架构图"},"content":[{"type":"text","text":"架构图"}]},{"type":"codeBlock","attrs":{"language":null},"content":[{"type":"text","text":"┌─────────────────────────────────────────────────────────────┐\n│                        Android 系统                          │\n│  ┌─────────────────────────────────────────────────────┐   │\n│  │                  Termux 环境                         │   │\n│  │  ┌─────────────┐  ┌─────────────┐  ┌──────────────┐ │   │\n│  │  │ termux:boot │→ │ frpc-start │→ │ frpc        │ │   │\n│  │  │ (开机执行)   │→ │ (wake lock) │  │ openclaw    │ │   │\n│  │  └─────────────┘  └─────────────┘  └──────────────┘ │   │\n│  │                                                  │     │   │\n│  │  ┌─────────────┐  ┌────────────────────────────┐  │     │   │\n│  │  │    cron     │→ │ monitor.sh (每5分钟执行)   │  │     │   │\n│  │  │ (定时检测)   │  │ 检测进程是否存在 → 重启    │  │     │   │\n│  │  └─────────────┘  └────────────────────────────┘  │     │   │\n│  └─────────────────────────────────────────────────────┘   │\n└─────────────────────────────────────────────────────────────┘\n"}]},{"type":"horizontalRule"},{"type":"heading","attrs":{"level":2,"id":"依赖安装"},"content":[{"type":"text","text":"依赖安装"}]},{"type":"codeBlock","attrs":{"language":null},"content":[{"type":"text","text":"# 安装 tmux（会话管理）\npkg install tmux\n\n# 安装 cron（定时任务）\npkg install crontab\n\n# 安装 termux:boot（开机自启）\npkg install termux-boot\n"}]},{"type":"blockquote","content":[{"type":"paragraph","content":[{"type":"text","marks":[{"type":"bold"}],"text":"termux:boot 安装后需要在 Android 设置中授权自启动权限"}]}]},{"type":"horizontalRule"},{"type":"heading","attrs":{"level":2,"id":"️-关键经验教训"},"content":[{"type":"text","text":"⚠️ 关键经验教训"}]},{"type":"orderedList","attrs":{"start":1,"type":null},"content":[{"type":"listItem","content":[{"type":"paragraph","content":[{"type":"text","marks":[{"type":"bold"}],"text":"termux:boot 只在开机时执行一次"},{"type":"text","text":"，杀进程后不会自动重启"}]}]},{"type":"listItem","content":[{"type":"paragraph","content":[{"type":"text","marks":[{"type":"bold"}],"text":"boot 脚本不能用环境变量"},{"type":"text","text":"，必须硬编码 token 和 port"}]}]},{"type":"listItem","content":[{"type":"paragraph","content":[{"type":"text","marks":[{"type":"bold"}],"text":"crond 必须加入 boot 脚本"},{"type":"text","text":"，否则进程监控不生效"}]}]},{"type":"listItem","content":[{"type":"paragraph","content":[{"type":"text","marks":[{"type":"bold"}],"text":"monitor.sh 用绝对路径"},{"type":"text","text":"，cron 环境下 $PREFIX 不生效"}]}]},{"type":"listItem","content":[{"type":"paragraph","content":[{"type":"text","marks":[{"type":"bold"}],"text":"frpc 用 exec 启动"},{"type":"text","text":"，确保 wake lock 正确持有，防止休眠被杀死"}]}]},{"type":"listItem","content":[{"type":"paragraph","content":[{"type":"text","marks":[{"type":"bold"}],"text":"monitor.sh 添加日志"},{"type":"text","text":"，便于追踪重启历史和调试"}]}]}]},{"type":"codeBlock","attrs":{"language":null},"content":[{"type":"text","text":"LOG_FILE=$HOME/monitor.log\nlog() {\n    echo \"[$(date)] $1\" >> \"$LOG_FILE\"\n}\n"}]},{"type":"horizontalRule"},{"type":"heading","attrs":{"level":2,"id":"脚本内容"},"content":[{"type":"text","text":"脚本内容"}]},{"type":"heading","attrs":{"level":3,"id":"1-OpenClaw-启动脚本-openclaw-runsh"},"content":[{"type":"text","text":"1. OpenClaw 启动脚本 ("},{"type":"text","marks":[{"type":"code"}],"text":"~/openclaw-run.sh"},{"type":"text","text":")"}]},{"type":"paragraph","content":[{"type":"text","text":"负责清理旧进程、重新启动 OpenClaw："}]},{"type":"codeBlock","attrs":{"language":null},"content":[{"type":"text","text":"#!/data/data/com.termux/files/usr/bin/bash\n# OpenClaw 启动脚本\n\n# 杀掉旧进程\npkill -9 -f 'openclaw' 2>/dev/null\ntmux kill-session -t openclaw 2>/dev/null\n\n# 等待资源释放\nsleep 1\n\n# 创建新 tmux 会话\ntmux new -d -s openclaw\n\n# 等待会话就绪\nsleep 1\n\n# 发送启动命令到 tmux 会话\ntmux send-keys -t openclaw \"export PATH=$NPM_BIN:\\$PATH TMPDIR=\\$HOME/tmp; export OPENCLAW_GATEWAY_TOKEN=$TOKEN; openclaw gateway --bind lan --port $PORT --token \\$OPENCLAW_GATEWAY_TOKEN --allow-unconfigured\" C-m\n"}]},{"type":"heading","attrs":{"level":3,"id":"2-开机启动脚本-termuxbootservicessh"},"content":[{"type":"text","text":"2. 开机启动脚本 ("},{"type":"text","marks":[{"type":"code"}],"text":"~/.termux/boot/services.sh"},{"type":"text","text":")"}]},{"type":"paragraph","content":[{"type":"text","text":"手机开机时自动启动 crond、frpc 和 OpenClaw："}]},{"type":"codeBlock","attrs":{"language":null},"content":[{"type":"text","text":"#!/data/data/com.termux/files/usr/bin/bash\n# termux:boot services - 开机会话启动\n\n# 启动 crond（关键）\ncrond\n\n# 启动 frpc（使用独立脚本，包含 wake lock）\nbash ~/.termux/boot/frpc-start.sh &\n\n# 清理旧 OpenClaw 进程后启动\npkill -9 -f 'openclaw' 2>/dev/null\ntmux kill-session -t openclaw 2>/dev/null\nsleep 1\ntmux new -d -s openclaw\nsleep 1\n# 注意：这里必须用硬编码的参数，不能用环境变量\ntmux send-keys -t openclaw \"export PATH=/data/data/com.termux/files/home/.npm-global/bin:\\$PATH TMPDIR=\\$HOME/tmp; export OPENCLAW_GATEWAY_TOKEN=tokenac27a3d5; openclaw gateway --bind lan --port 18789 --token \\$OPENCLAW_GATEWAY_TOKEN --allow-unconfigured\" C-m\n"}]},{"type":"heading","attrs":{"level":3,"id":"3-frpc-启动脚本-termuxbootfrpc-startsh"},"content":[{"type":"text","text":"3. frpc 启动脚本 ("},{"type":"text","marks":[{"type":"code"}],"text":"~/.termux/boot/frpc-start.sh"},{"type":"text","text":")"}]},{"type":"paragraph","content":[{"type":"text","text":"负责启动 frpc 并持有 wake lock，防止系统休眠导致进程被杀死："}]},{"type":"codeBlock","attrs":{"language":null},"content":[{"type":"text","text":"#!/data/data/com.termux/files/usr/bin/bash\ntermux-wake-lock\n/data/data/com.termux/files/usr/bin/frpc -c /data/data/com.termux/files/usr/etc/frp/frpc.ini\n"}]},{"type":"heading","attrs":{"level":3,"id":"4-进程监控脚本-monitorsh"},"content":[{"type":"text","text":"4. 进程监控脚本 ("},{"type":"text","marks":[{"type":"code"}],"text":"~/monitor.sh"},{"type":"text","text":")"}]},{"type":"paragraph","content":[{"type":"text","text":"每5分钟检测一次，崩溃则重启："}]},{"type":"codeBlock","attrs":{"language":null},"content":[{"type":"text","text":"#!/data/data/com.termux/files/usr/bin/bash\n# 进程监控脚本 - 每5分钟检测并重启崩溃的服务\n\nLOG_FILE=$HOME/monitor.log\nMAX_LOG_LINES=1000  # 日志最大行数\n\nlog() {\n    echo \"[$(date '+%Y-%m-%d %H:%M:%S')] $1\" >> \"$LOG_FILE\"\n}\n\ntrim_log() {\n    # 保留最后 MAX_LOG_LINES 行\n    local lines=$(wc -l < \"$LOG_FILE\" 2>/dev/null || echo 0)\n    if [ \"$lines\" -gt \"$MAX_LOG_LINES\" ]; then\n        tail -n \"$MAX_LOG_LINES\" \"$LOG_FILE\" > \"$LOG_FILE.tmp\"\n        mv \"$LOG_FILE.tmp\" \"$LOG_FILE\"\n    fi\n}\n\nlog \"========== Monitor started ==========\"\n\n# frpc 检测\nif ! pgrep -f \"frpc\" > /dev/null; then\n    log \"frpc 进程不存在，准备重启...\"\n    tmux kill-session -t frpc 2>/dev/null\n    sleep 1\n    # 用 exec 确保 wake lock 正确持有\n    tmux new-session -d -s frpc \"exec /data/data/com.termux/files/usr/bin/frpc -c /data/data/com.termux/files/usr/etc/frp/frpc.ini\"\n    log \"frpc 重启命令已发送\"\nelse\n    log \"frpc 运行正常\"\nfi\n\n# OpenClaw 检测\nif ! pgrep -f \"openclaw.*gateway\" > /dev/null; then\n    log \"OpenClaw 进程不存在，准备重启...\"\n    tmux kill-session -t openclaw 2>/dev/null\n    sleep 2  # 等待端口释放\n    bash ~/openclaw-run.sh\n    log \"OpenClaw 重启命令已发送\"\nelse\n    log \"OpenClaw 运行正常\"\nfi\n\n# 清理日志\ntrim_log\n\nlog \"========== Monitor finished ==========\"\n"}]},{"type":"horizontalRule"},{"type":"heading","attrs":{"level":2,"id":"操作步骤"},"content":[{"type":"text","text":"操作步骤"}]},{"type":"heading","attrs":{"level":3,"id":"第一步安装依赖"},"content":[{"type":"text","text":"第一步：安装依赖"}]},{"type":"codeBlock","attrs":{"language":null},"content":[{"type":"text","text":"pkg update && pkg install tmux crontab termux-api\ncrond\n"}]},{"type":"heading","attrs":{"level":3,"id":"第二步创建脚本文件"},"content":[{"type":"text","text":"第二步：创建脚本文件"}]},{"type":"heading","attrs":{"level":4,"id":"创建目录"},"content":[{"type":"text","text":"创建目录"}]},{"type":"codeBlock","attrs":{"language":null},"content":[{"type":"text","text":"mkdir -p ~/.termux/boot\n"}]},{"type":"heading","attrs":{"level":4,"id":"创建-openclaw-runsh"},"content":[{"type":"text","text":"创建 "},{"type":"text","marks":[{"type":"code"}],"text":"~/openclaw-run.sh"}]},{"type":"paragraph","content":[{"type":"text","text":"（将下方内容写入文件，"},{"type":"text","marks":[{"type":"bold"}],"text":"注意：参数必须硬编码"},{"type":"text","text":"）"}]},{"type":"codeBlock","attrs":{"language":null},"content":[{"type":"text","text":"#!/data/data/com.termux/files/usr/bin/bash\n# OpenClaw 启动脚本 - 硬编码参数\n\n# 杀掉旧进程\npkill -9 -f 'openclaw' 2>/dev/null\ntmux kill-session -t openclaw 2>/dev/null\n\n# 等待资源释放（增加等待时间）\nsleep 2\n\n# 创建新 tmux 会话\ntmux new -d -s openclaw\n\n# 等待会话就绪\nsleep 1\n\n# 发送启动命令（硬编码所有参数）\ntmux send-keys -t openclaw \"export PATH=/data/data/com.termux/files/home/.npm-global/bin:\\$PATH TMPDIR=\\$HOME/tmp; export OPENCLAW_GATEWAY_TOKEN=tokenac27a3d5; openclaw gateway --bind lan --port 18789 --token \\$OPENCLAW_GATEWAY_TOKEN --allow-unconfigured\" C-m\n"}]},{"type":"heading","attrs":{"level":4,"id":"创建-termuxbootservicessh"},"content":[{"type":"text","text":"创建 "},{"type":"text","marks":[{"type":"code"}],"text":"~/.termux/boot/services.sh"}]},{"type":"paragraph","content":[{"type":"text","text":"（将下方内容写入文件，"},{"type":"text","marks":[{"type":"bold"}],"text":"注意：参数必须硬编码"},{"type":"text","text":"）"}]},{"type":"codeBlock","attrs":{"language":null},"content":[{"type":"text","text":"#!/data/data/com.termux/files/usr/bin/bash\n# termux:boot services - 开机会话启动\n\n# 1. 清理旧会话\ntmux kill-session -t frpc 2>/dev/null\ntmux kill-session -t openclaw 2>/dev/null\nsleep 1\n\n# 2. 启动 crond（关键）\ncrond\n\n# 3. 启动 frpc（持有 wake lock）\ntmux new-session -d -s frpc \"exec /data/data/com.termux/files/usr/bin/frpc -c /data/data/com.termux/files/usr/etc/frp/frpc.ini\"\n\n# 4. 启动 OpenClaw\ntmux new -d -s openclaw\nsleep 1\ntmux send-keys -t openclaw \"export PATH=/data/data/com.termux/files/home/.npm-global/bin:\\$PATH TMPDIR=\\$HOME/tmp; export OPENCLAW_GATEWAY_TOKEN=tokenac27a3d5; openclaw gateway --bind lan --port 18789 --token \\$OPENCLAW_GATEWAY_TOKEN --allow-unconfigured\" C-m\n\nlog \"Services started at $(date)\" >> ~/boot.log 2>/dev/null || true\n"}]},{"type":"heading","attrs":{"level":4,"id":"创建-termuxbootfrpc-startsh"},"content":[{"type":"text","text":"创建 "},{"type":"text","marks":[{"type":"code"}],"text":"~/.termux/boot/frpc-start.sh"}]},{"type":"paragraph","content":[{"type":"text","text":"（将下方内容写入文件，包含 wake lock 防止休眠）"}]},{"type":"codeBlock","attrs":{"language":null},"content":[{"type":"text","text":"#!/data/data/com.termux/files/usr/bin/bash\ntermux-wake-lock\n/data/data/com.termux/files/usr/bin/frpc -c /data/data/com.termux/files/usr/etc/frp/frpc.ini\n"}]},{"type":"heading","attrs":{"level":4,"id":"创建-monitorsh"},"content":[{"type":"text","text":"创建 "},{"type":"text","marks":[{"type":"code"}],"text":"~/monitor.sh"}]},{"type":"paragraph","content":[{"type":"text","text":"（将下方内容写入文件，"},{"type":"text","marks":[{"type":"bold"}],"text":"注意：用 tmux 管理 frpc"},{"type":"text","text":"）"}]},{"type":"codeBlock","attrs":{"language":null},"content":[{"type":"text","text":"#!/data/data/com.termux/files/usr/bin/bash\n# frpc 检测\nif ! pgrep -f \"frpc\" > /dev/null; then\n    tmux new-session -d -s frpc \"frpc -c /data/data/com.termux/files/usr/etc/frp/frpc.ini\"\nfi\n\n# OpenClaw 检测\nif ! pgrep -f \"openclaw.*gateway\" > /dev/null; then\n    tmux kill-session -t openclaw 2>/dev/null\n    bash ~/openclaw-run.sh\nfi\n"}]},{"type":"heading","attrs":{"level":3,"id":"第三步设置权限"},"content":[{"type":"text","text":"第三步：设置权限"}]},{"type":"codeBlock","attrs":{"language":null},"content":[{"type":"text","text":"chmod +x ~/.termux/boot/services.sh ~/.termux/boot/frpc-start.sh ~/openclaw-run.sh ~/monitor.sh\n"}]},{"type":"heading","attrs":{"level":3,"id":"第四步配置-cron"},"content":[{"type":"text","text":"第四步：配置 cron"}]},{"type":"codeBlock","attrs":{"language":null},"content":[{"type":"text","text":"# 编辑 crontab\ncrontab -e\n\n# 添加以下内容（每5分钟检测一次）\n*/5 * * * * /data/data/com.termux/files/home/monitor.sh\n\n# 保存退出后，启动 cron 服务（这一步也可以放到 boot 脚本里自动执行）\ncrond\n"}]},{"type":"heading","attrs":{"level":3,"id":"第五步测试"},"content":[{"type":"text","text":"第五步：测试"}]},{"type":"codeBlock","attrs":{"language":null},"content":[{"type":"text","text":"# 手动启动 boot 脚本测试\nbash ~/.termux/boot/services.sh\n\n# 查看 tmux 会话\ntmux ls\n\n# 查看进程是否运行\nps aux | grep -E \"crond|frpc|openclaw\" | grep -v grep\n\n# 查看 crond 是否运行（验证 boot 脚本是否成功执行）\nps aux | grep crond | grep -v grep\n\n# 手动测试检测脚本\nbash ~/monitor.sh\n"}]},{"type":"heading","attrs":{"level":3,"id":"第六步验证开机自启动"},"content":[{"type":"text","text":"第六步：验证开机自启动"}]},{"type":"codeBlock","attrs":{"language":null},"content":[{"type":"text","text":"# 重启手机，验证以下进程是否自动启动：\n# 1. crond - 进程监控依赖它\n# 2. frpc - 内网穿透\n# 3. OpenClaw - 主服务\n\nps aux | grep -E \"crond|frpc|openclaw\" | grep -v grep\n"}]},{"type":"horizontalRule"},{"type":"heading","attrs":{"level":2,"id":"常用命令"},"content":[{"type":"text","text":"常用命令"}]},{"type":"paragraph","content":[{"type":"text","text":"操作 命令 查看 tmux 会话 "},{"type":"text","marks":[{"type":"code"}],"text":"tmux ls"},{"type":"text","text":" 查看 frpc 日志 "},{"type":"text","marks":[{"type":"code"}],"text":"tmux attach -t frpc"},{"type":"text","text":"（Ctrl+B 然后 D 退出） 查看 OpenClaw 日志 "},{"type":"text","marks":[{"type":"code"}],"text":"tmux attach -t openclaw"},{"type":"text","text":" 强制退出日志视图 "},{"type":"text","marks":[{"type":"code"}],"text":"Ctrl+B 然后 D"},{"type":"text","text":" 杀掉 tmux 会话 "},{"type":"text","marks":[{"type":"code"}],"text":"tmux kill-session -t frpc/openclaw"},{"type":"text","text":" 手动执行检测 "},{"type":"text","marks":[{"type":"code"}],"text":"bash /data/data/com.termux/files/home/monitor.sh"},{"type":"text","text":" 查看监控日志 "},{"type":"text","marks":[{"type":"code"}],"text":"tail -f ~/monitor.log"},{"type":"text","text":" 查看启动日志 "},{"type":"text","marks":[{"type":"code"}],"text":"tail -f ~/boot.log"},{"type":"text","text":" 查看 cron 日志 "},{"type":"text","marks":[{"type":"code"}],"text":"logcat -s crond"}]},{"type":"horizontalRule"},{"type":"heading","attrs":{"level":2,"id":"常见问题"},"content":[{"type":"text","text":"常见问题"}]},{"type":"heading","attrs":{"level":3,"id":"Q1-检测频率会影响电池吗"},"content":[{"type":"text","text":"Q1: 检测频率会影响电池吗？"}]},{"type":"paragraph","content":[{"type":"text","text":"不会。"},{"type":"text","marks":[{"type":"code"}],"text":"pgrep"},{"type":"text","text":" 进程检查是非常轻量的系统调用，比手机待机功耗低几个数量级。每5分钟一次完全可接受。"}]},{"type":"heading","attrs":{"level":3,"id":"Q2-为什么用-tmux-而不是-nohup"},"content":[{"type":"text","text":"Q2: 为什么用 tmux 而不是 nohup？"}]},{"type":"bulletList","content":[{"type":"listItem","content":[{"type":"paragraph","content":[{"type":"text","text":"tmux 可以方便地查看实时日志"}]}]},{"type":"listItem","content":[{"type":"paragraph","content":[{"type":"text","text":"tmux 保持会话不中断"}]}]},{"type":"listItem","content":[{"type":"paragraph","content":[{"type":"text","text":"可以随时手动连接查看状态"}]}]}]},{"type":"heading","attrs":{"level":3,"id":"Q3-termuxboot-没生效"},"content":[{"type":"text","text":"Q3: termux:boot 没生效？"}]},{"type":"paragraph","content":[{"type":"text","text":"检查： 1. Android 设置中允许 Termux 自启动 2. 脚本权限正确（"},{"type":"text","marks":[{"type":"code"}],"text":"chmod +x"},{"type":"text","text":"） 3. "},{"type":"text","marks":[{"type":"bold"}],"text":"boot 脚本里用了硬编码的路径和参数？"},{"type":"text","text":" 4. 重启手机测试，不只是重启 Termux app"}]},{"type":"heading","attrs":{"level":3,"id":"Q4-手机重启后-frpcOpenClaw-没启动"},"content":[{"type":"text","text":"Q4: 手机重启后 frpc/OpenClaw 没启动？"}]},{"type":"paragraph","content":[{"type":"text","text":"可能原因： 1. "},{"type":"text","marks":[{"type":"bold"}],"text":"crond 没在 boot 脚本里启动"},{"type":"text","text":" → monitor.sh 不会运行 2. "},{"type":"text","marks":[{"type":"bold"}],"text":"boot 脚本用了环境变量"},{"type":"text","text":" → 开机时 $TOKEN、$PORT 为空 3. "},{"type":"text","marks":[{"type":"bold"}],"text":"boot 脚本语法错误"},{"type":"text","text":" → 检查日志："},{"type":"text","marks":[{"type":"code"}],"text":"logcat -s termux:boot"}]},{"type":"heading","attrs":{"level":3,"id":"Q5-进程崩溃后没自动重启"},"content":[{"type":"text","text":"Q5: 进程崩溃后没自动重启？"}]},{"type":"paragraph","content":[{"type":"text","text":"可能原因： 1. "},{"type":"text","marks":[{"type":"bold"}],"text":"crond 没运行"},{"type":"text","text":" → "},{"type":"text","marks":[{"type":"code"}],"text":"ps aux | grep crond"},{"type":"text","text":" 2. "},{"type":"text","marks":[{"type":"bold"}],"text":"monitor.sh 路径错误"},{"type":"text","text":" → crontab 里用绝对路径 "},{"type":"text","marks":[{"type":"code"}],"text":"/data/data/com.termux/files/home/monitor.sh"},{"type":"text","text":" 3. "},{"type":"text","marks":[{"type":"bold"}],"text":"monitor.sh 里用了 $PREFIX"},{"type":"text","text":" → 改成绝对路径"}]},{"type":"heading","attrs":{"level":3,"id":"Q6-如何调整检测频率"},"content":[{"type":"text","text":"Q6: 如何调整检测频率？"}]},{"type":"paragraph","content":[{"type":"text","text":"编辑 crontab："}]},{"type":"codeBlock","attrs":{"language":null},"content":[{"type":"text","text":"crontab -e\n"}]},{"type":"bulletList","content":[{"type":"listItem","content":[{"type":"paragraph","content":[{"type":"text","text":"每1分钟："},{"type":"text","marks":[{"type":"code"}],"text":"* * * * * /data/data/com.termux/files/home/monitor.sh"}]}]},{"type":"listItem","content":[{"type":"paragraph","content":[{"type":"text","text":"每5分钟："},{"type":"text","marks":[{"type":"code"}],"text":"*/5 * * * * /data/data/com.termux/files/home/monitor.sh"}]}]},{"type":"listItem","content":[{"type":"paragraph","content":[{"type":"text","text":"每10分钟："},{"type":"text","marks":[{"type":"code"}],"text":"*/10 * * * * /data/data/com.termux/files/home/monitor.sh"}]}]}]},{"type":"heading","attrs":{"level":3,"id":"Q7-boot-脚本执行了但进程没起来"},"content":[{"type":"text","text":"Q7: boot 脚本执行了但进程没起来？"}]},{"type":"paragraph","content":[{"type":"text","text":"调试方法："}]},{"type":"codeBlock","attrs":{"language":null},"content":[{"type":"text","text":"# 手动执行 boot 脚本看报错\nbash -x ~/.termux/boot/services.sh\n\n# 查看 termux:boot 日志\nlogcat -s termux:boot\n\n# 检查环境变量是否存在\necho $TOKEN $PORT $PREFIX\n"}]},{"type":"heading","attrs":{"level":3,"id":"Q8-如何查看日志"},"content":[{"type":"text","text":"Q8: 如何查看日志？"}]},{"type":"codeBlock","attrs":{"language":null},"content":[{"type":"text","text":"# 查看监控日志（进程重启记录）\ntail -f ~/monitor.log\n\n# 查看启动日志\ntail -f ~/boot.log\n\n# 查看 tmux 会话日志\ntmux attach -t openclaw\ntmux attach -t frpc\n"}]},{"type":"horizontalRule"},{"type":"heading","attrs":{"level":2,"id":"效果"},"content":[{"type":"text","text":"效果"}]},{"type":"bulletList","content":[{"type":"listItem","content":[{"type":"paragraph","content":[{"type":"text","marks":[{"type":"bold"}],"text":"手机重启"},{"type":"text","text":" → crond + frpc + OpenClaw "},{"type":"text","marks":[{"type":"bold"}],"text":"全部自动启动"}]}]},{"type":"listItem","content":[{"type":"paragraph","content":[{"type":"text","marks":[{"type":"bold"}],"text":"进程崩溃"},{"type":"text","text":" → 5分钟内自动检测并重启"}]}]},{"type":"listItem","content":[{"type":"paragraph","content":[{"type":"text","marks":[{"type":"bold"}],"text":"随时查看日志"},{"type":"text","text":" → "},{"type":"text","marks":[{"type":"code"}],"text":"tmux attach -t openclaw"}]}]}]},{"type":"horizontalRule"},{"type":"heading","attrs":{"level":2,"id":"完整启动链路手机开机后"},"content":[{"type":"text","text":"完整启动链路（手机开机后）"}]},{"type":"codeBlock","attrs":{"language":null},"content":[{"type":"text","text":"手机开机\n    ↓\ntermux:boot 自动触发\n    ↓\nservices.sh 执行：\n  1. crond（关键！进程监控依赖它）\n  2. frpc-start.sh（持有 wake lock）\n  3. OpenClaw（主服务）\n    ↓\nfrpc 持有 termux-wake-lock，防止系统休眠\n    ↓\ncrond 每5分钟运行 monitor.sh\n    ↓\n检测到进程挂了 → 自动重启\n"}]},{"type":"horizontalRule"},{"type":"heading","attrs":{"level":2,"id":"参考资源"},"content":[{"type":"text","text":"参考资源"}]},{"type":"bulletList","content":[{"type":"listItem","content":[{"type":"paragraph","content":[{"type":"text","marks":[{"type":"link","attrs":{"href":"https://wiki.termux.com/wiki/Termux:Boot","target":"_blank","rel":"noopener noreferrer nofollow","class":null}}],"text":"Termux Wiki - Boot"}]}]},{"type":"listItem","content":[{"type":"paragraph","content":[{"type":"text","marks":[{"type":"link","attrs":{"href":"https://wiki.termux.com/wiki/Cron","target":"_blank","rel":"noopener noreferrer nofollow","class":null}}],"text":"Termux Wiki - Cron"}]}]},{"type":"listItem","content":[{"type":"paragraph","content":[{"type":"text","marks":[{"type":"link","attrs":{"href":"https://tmuxcheatsheet.com/","target":"_blank","rel":"noopener noreferrer nofollow","class":null}}],"text":"Tmux 常用命令"}]}]}]}]}